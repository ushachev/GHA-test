!function(){"use strict";var t,e={4119:function(t,e,r){r(5666);var n=r(8796),o={ru:{translation:{errors:{validation:{required:"Не должно быть пустым",url:"Ссылка должна быть валидным URL",doubleUrl:"RSS уже существует"},parsing:"Ресурс не содержит валидный RSS",network:"Ошибка сети",unknown:"Неизвестная ошибка. Что-то пошло не так."},results:{completed:"RSS успешно загружен"},elements:{feedsTitle:"Фиды",postsTitle:"Посты",readButton:"Просмотр"}}}},s=r(7424),i=r.n(s),a=r(9596),u=r.n(a);function l(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var c=function(t,e,r){var n=new(i())(document.getElementById("modal")),o={"rssForm.processState":function(){return function(t,e){switch(t.rssForm.processState){case"filling":e.submitBtn.disabled=!1,e.rssUrlInput.removeAttribute("readonly"),e.rssUrlInput.focus();break;case"processing":e.submitBtn.disabled=!0,e.rssUrlInput.setAttribute("readonly","");break;case"completed":e.rssForm.reset();break;default:throw Error("Unknown form state: ".concat(t.rssForm.processState))}}(t,e)},"rssForm.processResult":function(){return function(t,e){var r=t.rssForm,n=r.processState,o=r.processResult,s="completed"===n?"text-success":"text-danger";e.feedback.innerHTML=null===o?"":'<span class="'.concat(s,'">').concat(o,"</span>")}(t,e)},"rssForm.valid":function(){return e.rssUrlInput.classList.toggle("is-invalid")},appStatus:function(){return e.rssQuerySection.classList.toggle("my-auto")},feeds:function(){return function(t,e,r){var n=t.map((function(t){var e=t.title,r=t.description;return'\n      <li class="list-group-item">\n        <h3>'.concat(e,"</h3>\n        <p>").concat(r,"</p>\n      </li>\n    ")}));e.feedsContainer.innerHTML="\n    <h2>".concat(r.t("elements.feedsTitle"),'</h2>\n    <ul class="list-group">\n      ').concat(n.join("\n"),"\n    </ul>\n  ")}(t.feeds,e,r)},posts:function(t){return function(t,e,r){var n,o=t.posts,s=t.shownPostsIds,i=o.map((function(t){var e=t.id,n=t.title,o=t.link,i=s.has(e)?"fw-normal":"fw-bold";return'\n      <li class="list-group-item d-flex align-items-center p-3">\n        <a href="'.concat(o,'" class="').concat(i,' me-auto" data-id="').concat(e,'" target="_blank">').concat(n,'</a>\n        <button type="button" class="btn btn-secondary btn-sm" data-bs-toggle="modal" data-bs-target="#modal" data-id="').concat(e,'">').concat(r.t("elements.readButton"),"</button>\n      </li>\n    ")}));e.postsContainer.innerHTML="\n    <h2>".concat(r.t("elements.postsTitle"),'</h2>\n    <ul class="list-group">\n      ').concat(i.join("\n"),"\n    </ul>\n  "),(n=e.postsContainer.querySelectorAll("button"),function(t){if(Array.isArray(t))return l(t)}(n)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(n)||function(t,e){if(t){if("string"==typeof t)return l(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?l(t,e):void 0}}(n)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()).forEach((function(e){return e.addEventListener("click",(function(e){var r=e.target.dataset.id;t.modal.postId=r,t.shownPostsIds.add(r)}))}))}(t,e,r)},"modal.postId":function(){return function(t,e,r){var n=t.posts.find((function(e){return e.id===t.modal.postId})),o=e.postsContainer.querySelector('a[data-id="'.concat(t.modal.postId,'"]'));e.modalTitle.textContent=n.title,e.modalBody.textContent=n.description,e.modalPostLink.href=n.link,r.show(),o.classList.remove("fw-bold"),o.classList.add("fw-normal")}(t,e,n)}},s=u()(t,(function(t){var e;return null===(e=o[t])||void 0===e?void 0:e.call(o,s)}));return s},d=r(9501),f=r(9669),p=r.n(f),m=r(3955),y=r.n(m);function b(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var v=function(t){var e,r=t.contents,n=(new DOMParser).parseFromString(r,"application/xml");if("rss"!==n.documentElement.nodeName)throw new Error("errors.parsing");return{feed:{title:n.querySelector("channel title").textContent,description:n.querySelector("channel description").textContent},posts:(e=n.querySelectorAll("channel item"),function(t){if(Array.isArray(t))return b(t)}(e)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(e)||function(t,e){if(t){if("string"==typeof t)return b(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?b(t,e):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()).map((function(t){return{title:t.querySelector("title").textContent,description:t.querySelector("description").textContent,link:t.querySelector("link").textContent}}))}};function h(t){return function(t){if(Array.isArray(t))return g(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return g(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?g(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function g(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function w(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function S(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?w(Object(r),!0).forEach((function(e){O(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):w(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function O(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}d.i_({mixed:{required:"errors.validation.required"},string:{required:"errors.validation.required",url:"errors.validation.url"}});var I=d.Z_().trim().required().url(),k=function(t){return p().get("https://hexlet-allorigins.herokuapp.com/get",{params:{url:t,disableCache:!0}}).catch((function(){throw new Error("errors.network")}))},j=function(t,e,r){return function(n){n.preventDefault();var o=new FormData(n.target);t.rssForm.valid=!0,t.rssForm.processResult=null,t.rssForm.processState="processing",I.validate(o.get("url")).then((function(e){if(t.feeds.find((function(t){return t.url===e})))throw new d.p8("errors.validation.doubleUrl");return k(e)})).then((function(n){var o=n.config,s=n.data,i=v(s),a=i.feed,u=i.posts;"initial"===t.appStatus&&(t.appStatus="filled",function(t,e){setTimeout((function r(){var n=t.feeds.map((function(e){var r=e.id,n=e.url;return k(n).then((function(e){var n,o=e.data,s=v(o).posts,i=t.posts.filter((function(t){return t.feedId===r})).map((function(t){return t.link})),a=s.filter((function(t){var e=t.link;return!i.includes(e)})).map((function(t){return S({id:y()("post_"),feedId:r},t)}));(n=t.posts).push.apply(n,h(a))}))}));Promise.allSettled(n).then((function(){return setTimeout(r,e)}))}),e)}(t,r)),t.rssForm.processState="completed",t.rssForm.processResult=e.t("results.completed"),function(t,e,r,n){var o,s=y()("feed_"),i=n.map((function(t){return S({id:y()("post_"),feedId:s},t)}));t.feeds.push(S({id:s,url:e},r)),(o=t.posts).push.apply(o,h(i))}(t,o.params.url,a,u)})).catch((function(r){t.rssForm.valid="ValidationError"!==r.name,t.rssForm.processResult=e.t(r.message,e.t("errors.unknown"))})).then((function(){t.rssForm.processState="filling"}))}};function A(t,e,r,n,o,s,i){try{var a=t[s](i),u=a.value}catch(t){return void r(t)}a.done?e(u):Promise.resolve(u).then(n,o)}function E(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var s=t.apply(e,r);function i(t){A(s,n,o,i,a,"next",t)}function a(t){A(s,n,o,i,a,"throw",t)}i(void 0)}))}}E(regeneratorRuntime.mark((function t(){var e,r,s,i,a,u,l=arguments;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=l.length>0&&void 0!==l[0]?l[0]:5e3,r=n.Z.createInstance(),t.next=4,r.init({lng:"ru",debug:!1,resources:o});case 4:s={appStatus:"initial",feeds:[],posts:[],shownPostsIds:new Set,rssForm:{valid:!0,processState:"filling",processResult:null},modal:{postId:null}},i={rssQuerySection:document.getElementById("rssQuery"),rssForm:document.getElementById("rssForm"),rssUrlInput:document.getElementById("url"),submitBtn:document.querySelector('button[type="submit"]'),feedback:document.getElementById("feedback"),feedsContainer:document.getElementById("feedsContainer"),postsContainer:document.getElementById("postsContainer"),modalTitle:document.getElementById("modalLabel"),modalBody:document.querySelector(".modal-body"),modalPostLink:document.getElementById("modalPostLink")},a=c(s,i,r),u=j(a,r,e),i.rssForm.addEventListener("submit",u);case 9:case"end":return t.stop()}}),t)})))()}},r={};function n(t){var o=r[t];if(void 0!==o)return o.exports;var s=r[t]={id:t,loaded:!1,exports:{}};return e[t].call(s.exports,s,s.exports,n),s.loaded=!0,s.exports}n.m=e,t=[],n.O=function(e,r,o,s){if(!r){var i=1/0;for(l=0;l<t.length;l++){r=t[l][0],o=t[l][1],s=t[l][2];for(var a=!0,u=0;u<r.length;u++)(!1&s||i>=s)&&Object.keys(n.O).every((function(t){return n.O[t](r[u])}))?r.splice(u--,1):(a=!1,s<i&&(i=s));a&&(t.splice(l--,1),e=o())}return e}s=s||0;for(var l=t.length;l>0&&t[l-1][2]>s;l--)t[l]=t[l-1];t[l]=[r,o,s]},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,{a:e}),e},n.d=function(t,e){for(var r in e)n.o(e,r)&&!n.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.nmd=function(t){return t.paths=[],t.children||(t.children=[]),t},function(){var t={179:0};n.O.j=function(e){return 0===t[e]};var e=function(e,r){var o,s,i=r[0],a=r[1],u=r[2],l=0;for(o in a)n.o(a,o)&&(n.m[o]=a[o]);if(u)var c=u(n);for(e&&e(r);l<i.length;l++)s=i[l],n.o(t,s)&&t[s]&&t[s][0](),t[i[l]]=0;return n.O(c)},r=self.webpackChunkGHA_test=self.webpackChunkGHA_test||[];r.forEach(e.bind(null,0)),r.push=e.bind(null,r.push.bind(r))}();var o=n.O(void 0,[199],(function(){return n(4119)}));o=n.O(o)}();
//# sourceMappingURL=main.js.map